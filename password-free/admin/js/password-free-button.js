const animationDurationMs = 5500;
const delayFirstAnimationMs = 50;
const delaySecondAnimationMs = 5000;
const firstStarColor = '#F75507';
const secondStarColor = '#f5dc1e';
const pfRegisterRedirectUrl = buttonVariables['pfRegisterRedirectUrl'];
const pfAuthRedirectUrl = buttonVariables['pfAuthRedirectUrl'];

function createButtonWithWrapper() {
    const buttonElements = document.querySelectorAll('.password-free-button');
    buttonElements.forEach((buttonElement) => {
            for (let i = 0; i < 3; i++) {
                const animationElement = createStarWithWrapper();
                if (buttonElement.offsetWidth > 270) {
                    buttonElement.insertAdjacentElement('afterend', animationElement);
                } else {
                    buttonElement.insertAdjacentElement('afterbegin', animationElement);
                }
                playAnimations([delayFirstAnimationMs, delaySecondAnimationMs], animationElement, buttonElement, i);
            };
    }
    )
}

function createStarWithWrapper() {
    const starWrapper = document.createElement('div');
    starWrapper.classList.add('password-free-star');
    starWrapper.innerHTML = '<svg width="30" height="30" viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">\n' +
        '<path d="M20.321 19.3822L24.2022 24.206L19.3785 20.3284C18.0239 19.2404 16.3385 18.6474 14.6011 18.6474C12.8637 18.6474 11.1783 19.2404 9.82375 20.3284L5 24.206L8.88127 19.3822C9.96764 18.0262 10.5596 16.3405 10.5596 14.603C10.5596 12.8655 9.96764 11.1798 8.88127 9.82375L5 5L9.82375 8.87756C11.1792 9.96364 12.8642 10.5555 14.6011 10.5555C16.338 10.5555 18.0231 9.96364 19.3785 8.87756L24.2022 5L20.321 9.82375C19.2346 11.1798 18.6426 12.8655 18.6426 14.603C18.6426 16.3405 19.2346 18.0262 20.321 19.3822Z" fill="#F75507"/>\n' +
        '<path d="M14.217 8.79221L13.5677 9.46383L14.0055 8.64008C14.076 8.50919 14.1195 8.3655 14.1335 8.21751C14.1475 8.06952 14.1318 7.92023 14.0872 7.77843C14.0426 7.63663 13.97 7.5052 13.8738 7.3919C13.7775 7.2786 13.6596 7.18572 13.5269 7.11874L12.6846 6.71058L13.6048 6.87014C13.7523 6.89654 13.9036 6.89288 14.0496 6.85941C14.1957 6.82593 14.3335 6.76331 14.4547 6.6753C14.576 6.5873 14.6783 6.47572 14.7554 6.34725C14.8325 6.21878 14.8829 6.07605 14.9035 5.92764L15.0334 5L15.1632 5.92764C15.1839 6.07605 15.2342 6.21878 15.3114 6.34725C15.3885 6.47572 15.4907 6.5873 15.612 6.6753C15.7333 6.76331 15.871 6.82593 16.0171 6.85941C16.1631 6.89288 16.3144 6.89654 16.4619 6.87014L17.3859 6.71058L16.5436 7.11874C16.4083 7.18401 16.2876 7.27598 16.1888 7.38911C16.0901 7.50224 16.0152 7.63419 15.9687 7.77702C15.9223 7.91985 15.9052 8.0706 15.9185 8.2202C15.9319 8.3698 15.9754 8.51515 16.0464 8.6475L16.4879 9.47125L15.8386 8.79964C15.735 8.68853 15.6098 8.59979 15.4706 8.53889C15.3315 8.47799 15.1813 8.44621 15.0294 8.44552C14.8775 8.44482 14.7271 8.47522 14.5874 8.53485C14.4477 8.59447 14.3216 8.68206 14.217 8.79221Z" fill="#F75507"/>\n' +
        '<path d="M10.5065 24.2319L9.76435 25L10.2653 24.0575C10.346 23.9063 10.3955 23.7405 10.4108 23.5698C10.4261 23.3991 10.4069 23.227 10.3542 23.0639C10.3016 22.9008 10.2166 22.75 10.1045 22.6204C9.99228 22.4909 9.85516 22.3852 9.70127 22.3098L8.74023 21.8423L9.79033 22.0278C9.9588 22.0579 10.1316 22.0537 10.2984 22.0155C10.4653 21.9773 10.6227 21.9058 10.7612 21.8053C10.8998 21.7049 11.0167 21.5775 11.1049 21.4308C11.1931 21.2842 11.2508 21.1212 11.2746 20.9517L11.423 19.8905L11.5751 20.9517C11.5989 21.1212 11.6566 21.2842 11.7448 21.4308C11.833 21.5775 11.9499 21.7049 12.0885 21.8053C12.227 21.9058 12.3844 21.9773 12.5512 22.0155C12.7181 22.0537 12.8909 22.0579 13.0593 22.0278L14.1094 21.8423L13.1484 22.3098C12.9945 22.3852 12.8574 22.4909 12.7452 22.6204C12.633 22.75 12.5481 22.9008 12.4955 23.0639C12.4428 23.227 12.4236 23.3991 12.4389 23.5698C12.4541 23.7405 12.5036 23.9063 12.5844 24.0575L13.0853 25L12.3432 24.2319C12.2242 24.1086 12.0815 24.0105 11.9237 23.9435C11.7659 23.8765 11.5963 23.842 11.4248 23.842C11.2534 23.842 11.0838 23.8765 10.926 23.9435C10.7682 24.0105 10.6255 24.1086 10.5065 24.2319Z" fill="#F75507"/>\n' +
        '<path d="M6.53988 18.6734L6.27272 18.9517L6.45454 18.6104C6.48318 18.5552 6.50052 18.4948 6.50556 18.4329C6.5106 18.3709 6.50323 18.3085 6.48388 18.2495C6.46453 18.1904 6.4336 18.1357 6.39288 18.0888C6.35216 18.0418 6.30248 18.0034 6.24674 17.9758L5.89795 17.8089L6.26901 17.8757C6.33001 17.8862 6.39251 17.8845 6.45282 17.8705C6.51313 17.8565 6.57004 17.8306 6.62018 17.7943C6.67032 17.758 6.71269 17.712 6.74478 17.6591C6.77687 17.6061 6.79804 17.5473 6.80704 17.486L6.85899 17.115L6.91465 17.486C6.92308 17.5488 6.94425 17.6091 6.97686 17.6633C7.00946 17.7175 7.05282 17.7645 7.10426 17.8013C7.1557 17.8382 7.21414 17.8641 7.27597 17.8775C7.3378 17.8909 7.40173 17.8916 7.46381 17.8794L7.83487 17.8126L7.48608 17.9796C7.42999 18.0067 7.37994 18.0449 7.33894 18.0918C7.29793 18.1387 7.2668 18.1935 7.24741 18.2527C7.22801 18.3119 7.22075 18.3744 7.22605 18.4365C7.23136 18.4986 7.24912 18.559 7.27828 18.6141L7.4601 18.9554L7.19294 18.6771C7.15042 18.6338 7.09974 18.5993 7.04383 18.5757C6.98792 18.552 6.92789 18.5397 6.86718 18.5393C6.80648 18.539 6.7463 18.5507 6.69013 18.5737C6.63396 18.5967 6.58289 18.6306 6.53988 18.6734Z" fill="#F75507"/>\n' +
        '<path d="M5.86453 8.84783L5.56769 9.15581L5.76806 8.78475C5.80042 8.72438 5.82024 8.65808 5.82633 8.58986C5.83243 8.52163 5.82468 8.45288 5.80354 8.38772C5.78239 8.32257 5.74831 8.26236 5.70331 8.21071C5.65832 8.15906 5.60335 8.11703 5.54171 8.08716L5.17065 7.89792L5.59366 7.97213C5.66106 7.98428 5.73022 7.98268 5.79699 7.96743C5.86376 7.95219 5.92676 7.92361 5.98221 7.88341C6.03766 7.84321 6.08441 7.79222 6.11967 7.7335C6.15492 7.67478 6.17794 7.60954 6.18735 7.5417L6.24672 7.11499L6.30609 7.5417C6.3155 7.60954 6.33853 7.67478 6.37378 7.7335C6.40903 7.79222 6.45579 7.84321 6.51123 7.88341C6.56668 7.92361 6.62968 7.95219 6.69645 7.96743C6.76322 7.98268 6.83238 7.98428 6.89978 7.97213L7.32279 7.89792L6.95173 8.08716C6.89045 8.11743 6.83585 8.15966 6.79115 8.21137C6.74645 8.26308 6.71255 8.32321 6.69146 8.38823C6.67036 8.45324 6.6625 8.52182 6.66832 8.58992C6.67415 8.65802 6.69355 8.72427 6.72539 8.78475L6.92576 9.15581L6.62891 8.84783C6.58088 8.79396 6.52199 8.75085 6.45613 8.72133C6.39026 8.69182 6.3189 8.67656 6.24672 8.67656C6.17455 8.67656 6.10318 8.69182 6.03732 8.72133C5.97145 8.75085 5.91257 8.79396 5.86453 8.84783Z" fill="#F75507"/>\n' +
        '<path d="M18.9146 6.55845L18.6475 6.83674L18.8293 6.49537C18.8585 6.4408 18.8764 6.38089 18.882 6.31924C18.8875 6.25759 18.8805 6.19545 18.8614 6.13656C18.8424 6.07766 18.8116 6.02321 18.7711 5.97648C18.7305 5.92974 18.6809 5.89168 18.6252 5.86457L18.2764 5.69388L18.6475 5.76067C18.7083 5.77175 18.7708 5.77036 18.8311 5.75657C18.8914 5.74277 18.9482 5.71687 18.9982 5.68044C19.0482 5.644 19.0902 5.59779 19.1218 5.54461C19.1533 5.49142 19.1738 5.43238 19.1818 5.37106L19.2375 5L19.2894 5.37106C19.2979 5.43253 19.3188 5.49165 19.3507 5.54485C19.3827 5.59805 19.4251 5.64424 19.4753 5.68064C19.5256 5.71704 19.5827 5.74289 19.6432 5.75664C19.7037 5.7704 19.7664 5.77177 19.8275 5.76067L20.1985 5.69388L19.8497 5.86457C19.7941 5.89168 19.7445 5.92974 19.7039 5.97648C19.6633 6.02321 19.6325 6.07766 19.6135 6.13656C19.5944 6.19545 19.5875 6.25759 19.593 6.31924C19.5985 6.38089 19.6164 6.4408 19.6456 6.49537L19.8275 6.83674L19.5566 6.55845C19.4707 6.47481 19.3555 6.42801 19.2356 6.42801C19.1157 6.42801 19.0006 6.47481 18.9146 6.55845Z" fill="#F75507"/>\n' +
        '<path d="M16.6772 22.3543L16.3061 22.7439L16.5621 22.2653C16.6027 22.1886 16.6274 22.1045 16.6348 22.0181C16.6421 21.9317 16.632 21.8446 16.605 21.7622C16.578 21.6798 16.5346 21.6037 16.4775 21.5383C16.4204 21.473 16.3508 21.4199 16.2727 21.3821L15.7866 21.1447L16.3209 21.2374C16.4058 21.2506 16.4924 21.2467 16.5758 21.2262C16.6591 21.2056 16.7376 21.1688 16.8066 21.1177C16.8756 21.0666 16.9338 21.0024 16.9778 20.9287C17.0219 20.8549 17.0508 20.7732 17.0631 20.6883L17.1373 20.1539L17.2152 20.6883C17.2265 20.7737 17.2548 20.8559 17.2985 20.9301C17.3423 21.0044 17.4005 21.069 17.4698 21.1203C17.539 21.1715 17.6179 21.2083 17.7016 21.2284C17.7854 21.2485 17.8723 21.2516 17.9573 21.2374L18.4916 21.1447L18.0055 21.3821C17.9274 21.4199 17.8578 21.473 17.8008 21.5384C17.7438 21.6038 17.7006 21.6801 17.6739 21.7626C17.6472 21.8451 17.6375 21.9322 17.6454 22.0186C17.6533 22.105 17.6786 22.1889 17.7198 22.2653L17.9722 22.7439L17.6011 22.3543C17.5407 22.2932 17.4688 22.2446 17.3895 22.2115C17.3102 22.1783 17.2251 22.1613 17.1391 22.1613C17.0532 22.1613 16.9681 22.1783 16.8888 22.2115C16.8095 22.2446 16.7376 22.2932 16.6772 22.3543Z" fill="#F75507"/>\n' +
        '<path d="M7.46012 16.2988L7.08906 16.6699L7.34509 16.1912C7.38573 16.1143 7.41049 16.0299 7.41789 15.9432C7.4253 15.8565 7.4152 15.7692 7.38821 15.6865C7.36121 15.6038 7.31786 15.5273 7.26073 15.4617C7.20361 15.396 7.13387 15.3425 7.05567 15.3044L6.56958 15.0669L7.1039 15.1634C7.18875 15.1765 7.27536 15.1727 7.35872 15.1521C7.44208 15.1316 7.52054 15.0947 7.58956 15.0436C7.65857 14.9926 7.71678 14.9283 7.7608 14.8546C7.80482 14.7809 7.83379 14.6992 7.84602 14.6142L7.92023 14.0762L7.99815 14.6142C8.00991 14.6994 8.03857 14.7814 8.08245 14.8553C8.12633 14.9293 8.18455 14.9938 8.25368 15.0449C8.32281 15.0961 8.40146 15.1329 8.48502 15.1532C8.56858 15.1736 8.65536 15.177 8.74027 15.1634L9.27459 15.0669L8.7848 15.3044C8.70655 15.3425 8.63681 15.396 8.57977 15.4617C8.52274 15.5275 8.47958 15.604 8.45289 15.6869C8.4262 15.7697 8.41654 15.8571 8.42447 15.9438C8.43241 16.0304 8.45779 16.1146 8.49908 16.1912L8.7514 16.6699L8.38034 16.2988C8.32001 16.2382 8.24831 16.1902 8.16935 16.1574C8.09039 16.1246 8.00573 16.1077 7.92023 16.1077C7.83473 16.1077 7.75007 16.1246 7.67111 16.1574C7.59215 16.1902 7.52045 16.2382 7.46012 16.2988Z" fill="#F75507"/>\n' +
        '<path d="M22.7514 10.5066L22.3803 10.8962L22.6364 10.4175C22.6771 10.3408 22.7021 10.2567 22.7097 10.1701C22.7174 10.0836 22.7076 9.99639 22.681 9.9137C22.6543 9.831 22.6114 9.7545 22.5546 9.68871C22.4979 9.62292 22.4285 9.56919 22.3506 9.53069L21.8608 9.29321L22.3952 9.38598C22.4798 9.39966 22.5663 9.39635 22.6497 9.37624C22.733 9.35613 22.8115 9.31963 22.8806 9.26885C22.9497 9.21808 23.0079 9.15405 23.052 9.08051C23.0961 9.00697 23.1251 8.92539 23.1373 8.84052L23.2115 8.30249L23.2894 8.84052C23.3011 8.9256 23.3298 9.00746 23.3737 9.08125C23.4177 9.15504 23.476 9.21928 23.5452 9.27014C23.6144 9.321 23.6931 9.35746 23.7766 9.37736C23.8601 9.39725 23.9468 9.40019 24.0315 9.38598L24.5659 9.29321L24.0761 9.53069C23.9982 9.56919 23.9288 9.62292 23.8721 9.68871C23.8153 9.7545 23.7723 9.831 23.7457 9.9137C23.7191 9.99639 23.7093 10.0836 23.717 10.1701C23.7246 10.2567 23.7496 10.3408 23.7903 10.4175L24.0427 10.8962L23.6716 10.5066C23.6113 10.446 23.5396 10.3979 23.4606 10.3651C23.3816 10.3323 23.297 10.3154 23.2115 10.3154C23.126 10.3154 23.0413 10.3323 22.9624 10.3651C22.8834 10.3979 22.8117 10.446 22.7514 10.5066Z" fill="#F75507"/>\n' +
        '<path d="M20.2282 16.8812L19.5157 16.9109L20.1911 16.6883C20.3011 16.653 20.4029 16.5957 20.49 16.5197C20.5772 16.4438 20.6479 16.3509 20.6979 16.2467C20.748 16.1425 20.7762 16.0292 20.7809 15.9137C20.7856 15.7983 20.7667 15.683 20.7254 15.5751L20.4768 14.9109L20.8961 15.4897C20.9634 15.5822 21.0487 15.6601 21.1468 15.7188C21.2449 15.7776 21.3539 15.8159 21.4672 15.8315C21.5805 15.847 21.6958 15.8396 21.8062 15.8096C21.9165 15.7796 22.0197 15.7276 22.1094 15.6567L22.6697 15.2152L22.2504 15.794C22.1839 15.887 22.1367 15.9923 22.1116 16.1039C22.0866 16.2154 22.0842 16.3308 22.1046 16.4433C22.125 16.5558 22.1678 16.663 22.2305 16.7587C22.2932 16.8543 22.3744 16.9363 22.4694 16.9999L23.0631 17.397L22.3803 17.1781C22.2715 17.1428 22.1566 17.1299 22.0427 17.1402C21.9287 17.1504 21.818 17.1835 21.7172 17.2376C21.6164 17.2916 21.5275 17.3655 21.4559 17.4547C21.3843 17.544 21.3314 17.6468 21.3005 17.7569L21.1076 18.4434V17.7309C21.1071 17.617 21.0839 17.5042 21.0391 17.3994C20.9944 17.2945 20.9292 17.1997 20.8472 17.1205C20.7652 17.0413 20.6682 16.9793 20.5619 16.9382C20.4556 16.8971 20.3421 16.8777 20.2282 16.8812Z" fill="#F75507"/>\n' +
        '</svg>';
    return starWrapper;
}

function playAnimations(timeoutList, element, parentElement, index) {
    timeoutList.forEach(timeout => {
        setTimeout(() => {
            const delay = 0.05 * animationDurationMs * (index + 2);
            const lastStarIndex = 2;
            animateMovementAndRotation(element, parentElement, delay, index === lastStarIndex);
            for (let j = 0; j < element.children[0].children.length; j++) {
                animateChangeColor(element.children[0].children[j], delay);
            }
        }, timeout);
    });
}

function setDefaultPositionToStar(size, offset) {
    return -size / 2 - offset;
}

function animateMovementAndRotation(element, parentElement, delay, isLastStar) {
    const defaultLeft = setDefaultPositionToStar(element.offsetWidth, parentElement.clientLeft);
    const defaultTop = setDefaultPositionToStar(element.offsetHeight, parentElement.clientTop);
    element.animate(
        [
            {
                left: defaultLeft + "px",
                top: defaultTop + "px",
                transform: 'rotate(0turn)',
                scale: 0.8,
                opacity: 1,
                offset: 0
            },
            {
                left: parentElement.offsetWidth + defaultLeft + "px",
                top: defaultTop + "px",
                offset: 0.2,
            },
            {
                left: parentElement.offsetWidth + defaultLeft + "px",
                top:  parentElement.offsetHeight + defaultTop + "px",
                offset: 0.28,
            },
            {
                left: defaultLeft + "px",
                top:  parentElement.offsetHeight + defaultTop + "px",
                offset: 0.48,
            },
            {
                left: defaultLeft + "px",
                top:  defaultTop + "px",
                scale: 0.8,
                opacity: 1,
                offset: 0.56,
            },
            {
                transform: 'rotate(3.5turn)',
                scale: 1,
                opacity: 1,
                offset: 0.6,
            },
            {
                transform: 'rotate(4turn)',
                scale: 1.7,
                opacity: isLastStar ? 1 : 0,
                offset: 0.9,
            },
            {
                left: defaultLeft + "px",
                top:  defaultTop + "px",
                transform: 'rotate(4turn)',
                opacity: 0,
                offset: 1
            }
        ],
        {
            delay: delay,
            duration: animationDurationMs,
            iterations: 1,
            fill: "forwards",
            easing: 'ease-in-out'
        }
    );

}

function animateChangeColor(element, delay) {
    element.animate(
        [
            {
                fill: firstStarColor,
                offset: 0,
            },
            {
                fill: firstStarColor,
                offset: 0.56,
            },
            {
                fill: secondStarColor,
                offset: 0.67,
            },
            {
                fill: secondStarColor,
                offset: 1
            },
        ],
        {
            delay: delay,
            duration: animationDurationMs,
            iterations: 1,
            fill: "forwards"
        }
    );
}

function pfOnclick(isRegister) {
    window.location.href = isRegister ? pfRegisterRedirectUrl : pfAuthRedirectUrl;
}

createButtonWithWrapper();